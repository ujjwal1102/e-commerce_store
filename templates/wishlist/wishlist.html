{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
.fade-in{
    
    animation: fade 3s ease-in;
    animation-fill-mode: forwards;
}
@keyframes fadeIn {
    0%{
        opacity: 0;
    }
    100%{
        opacity: 1;
    }
    
}


.fade-in .fade-out{
    
    animation: fade 3s ease-in;
    animation-fill-mode: backwards;
}
@keyframes fadeIn {
    0%{
        opacity: 1;
    }
    100%{
        opacity: 0;
    }
    
}



</style>
<script>
    $(document).ready(function () {
        $('form#add_item_to_wishlist').on('click', function (e) {
            e.preventDefault();
            var data = $(this).serialize();
            console.log(data)
            $.ajax({
                url: "{% url 'add_to_wishlist' %}",
                type: 'POST',
                data: data,
                success: function (response) {
                    console.log(response.status, response.prod_id)
                    var element = document.getElementById("prod_btn" + response.prod_id);
                    var prod_icon = element.getElementsByTagName("i")
                    prod_icon[0].classList.add(response.status)
                    var cardid = document.getElementById('card'+response.prod_id)
                    cardid.remove()
                    

                    //if (response.status == 'bi-heart-fill') {
                    //    prod_icon[0].classList.remove("bi-heart")
                    //    prod_icon[0].classList.add(response.status)
                    //}
                    //else {
                    //    prod_icon[0].classList.add(response.status)
                    //}
                },
                error: function (xhr,status,error) {
                    console.log(error)
                }
            });
        });
    })
</script>
<script>
    window.onload = function () {
        const productCards = document.querySelectorAll('.product-card');
        productCards.forEach((card) => {
            const plusBtn = card.querySelector('.plus');
            const minusBtn = card.querySelector('.minus');
            const countInput = card.querySelector('.count');
            plusBtn.addEventListener('click', () => {
                countInput.value = parseInt(countInput.value) + 1;
            });
            minusBtn.addEventListener('click', () => {
                if (parseInt(countInput.value) > 1) {
                    countInput.value = parseInt(countInput.value) - 1;
                }
            });
        });
    }
</script>
<script>
    $(document).ready(function () {

        $('form#add_item_to_cart').submit(function (e) {
            e.preventDefault();
            var cartcount = document.getElementById('cartviewcount')
            var data = $(this).serialize();
            console.log(data)
            $.ajax({
                url: "{% url 'my_cart_add' %}",
                type: 'POST',
                data: data,
                success: function (response) {
                    cartcount.innerHTML = response.cartviewcount
                    console.log(response)
                },
                error: function (error) {
                    console.log(error)
                }
            });
        });
    })
</script>

<section>
    <div class="container">
        <div class="row">
            {% for prod in productwishlist_list %}
            <div class="col-lg-3 col-md-6 col-sm-6 fade-in " id="card{{prod.product.id}}">
                <div class="card my-2 shadow-0 product-card" >
                    <a href="{{ prod.product.get_absolute_url }}">
                        <!-- <div class="mask" >
                                <div class="d-flex justify-content-start align-items-start ">
                                    <h6><span class="badge pt-1" style="background-color: #f87217;">Offer</span></h6>
                                </div>
                            </div> -->
                        <img src="{{ prod.product.thumbnail_image.url }}" class="card-img-top rounded-2"
                            style="aspect-ratio: 1 / 1" />
                    </a>
                    <div>
                        <form id="add_item_to_wishlist" method="post">
                            {% csrf_token %}
    
                           
    
                            {% if prod.product.id in request.session.wishlist %}
                            <button type="submit" class="btn btn-outline-danger border-0 px-2 float-end heart-icon"
                                id="prod_btn{{prod.product.id}}" style="background:none;color:#d4403a"><i
                                    class="bi bi-heart-fill"></i></button>
                            {% else %}
                            <button type="submit" class="btn btn-outline-danger border-0 px-2 float-end heart-icon"
                                id="prod_btn{{prod.product.id}}" style="background:none;color:#d4403a"><i
                                    class=" bi bi-heart"></i></button>
                            {% endif %}
                            <input name="product_id" type="hidden" value="{{prod.product.id}}">
    
                        </form>
                    </div>
                    <div class="card-body pt-2 py-0">
                        <!-- <a href="#!" class="btn btn-light border px-2 pt-2 float-end icon-hover"><i
                                    class="fas fa-heart fa-lg px-1 text-secondary"></i></a> -->
                        <a href="{{ prod.product.get_absolute_url }}" class="nav-link">
                            <h5 class="card-title"><span>&#8377</span>{{prod.product.cost}}</h5>
                            <p class="card-text mb-0">{{prod.product.name|truncatechars:20}}</p>
                            <p class="text-muted small">
                                <small>{{prod.product.description|truncatechars:50}}</small>
                            </p>
                        </a>
                    </div>
                    <form id="add_item_to_cart" action="{% url 'my_cart_add' %}" method="post">
                        {% csrf_token %}
                        <div class="d-flex justify-content-between px-2 py-0">
                            <div>
                                <div class="input-group input-group-sm mb-3">
                                    <button id="minusBtn" {% if prod.product.product_id in request.session.mycart.keys %} disabled {% endif %} class="btn btn-outline-dark  btn-sm  py-1 px-2 minus"
                                        type="button" data-mdb-ripple-color="dark">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input readonly {% if prod.product_id in request.session.mycart.keys %} disabled {% endif %} type="text" name="quantity" id="count"
                                        class="form-control form-control-sm text-center border border-secondary count"
                                        value="1" style="max-width: 40px; min-width:25px; width:max-content;" />
                                    <input type="text" name="product_id" hidden value="{{prod.product.id}}">
                                    <button id="plusBtn" {% if prod.product.id in request.session.mycart.keys %} disabled {% endif %} class="btn btn-outline-dark btn-sm py-1 px-2 plus" type="button"
                                        data-mdb-ripple-color="dark">
                                        <small><i class="fas fa-plus"></i></small>
                                    </button>
                                </div>
                            </div>
                            <div class="">
                                <button type="submit" id="addtocart" {% if prod.product.id in request.session.mycart %}
                                    disabled {% endif %} class="btn btn-primary shadow-0 me-1 btn-sm "
                                    title="Add to cart" style="white-space: nowrap;">Add to Cart
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

{% endblock %}